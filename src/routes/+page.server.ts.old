import { supabase } from '$lib/supabase/supabaseClient';

interface HomepageCourse {
    id: string;
    title: string;
    short_description: string | null;
    thumbnail: string | null;
    language_taught: string;
    course_language: string;
    author_id: string;
    author_name: string;
    author_subtitle: string | null;
    author_avatar_url: string | null;
    enrolled_students: number;
    created_at: string;
    category: string;
}

export async function load() {

    const { data, error } = await supabase.rpc('get_home_page_courses');

    if (error) {
        console.error('Error loading home page courses:', error);
        return {
            popularCourses: [],
            trendingCourses: [],
            recentCourses: []
        };
    }

    // Organize courses by category
    const popularCourses = data?.filter((course: HomepageCourse) => course.category === 'popular') || [];
    const trendingCourses = data?.filter((course: HomepageCourse) => course.category === 'trending') || [];
    const recentCourses = data?.filter((course: HomepageCourse) => course.category === 'recent') || [];

    return {
        popularCourses,
        trendingCourses,
        recentCourses
    };
}